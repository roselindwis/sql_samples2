-- Roselin Dwi Septiani --

CREATE DATABASE University2

USE University2

CREATE TABLE Student(
	STUD_ID CHAR(5) PRIMARY KEY,
	STUD_FNAME VARCHAR(30) NOT NULL,
	STUD_LNAME VARCHAR(30) NOT NULL,
	STUD_STREET VARCHAR(50) NOT NULL,
	STUD_CITY VARCHAR(30) NOT NULL,

	CONSTRAINT CheckSTUD_ID CHECK (STUD_ID LIKE 'ST[0-9][0-9][0-9]')
)

CREATE TABLE Prof(
	PROF_ID CHAR(6) PRIMARY KEY,
	PROF_FNAME VARCHAR(30) NOT NULL,
	PROF_LNAME VARCHAR (30) NOT NULL,

	CONSTRAINT CheckProf_ID CHECK (PROF_ID LIKE '[A-Z][0-9][0-9][0-9][0-9][0-9]')
)

CREATE TABLE Class(
	CLASS_ID CHAR(8) PRIMARY KEY,
	CLASS_NAME VARCHAR(30) NOT NULL,
	PROF_ID CHAR(6),

	CONSTRAINT CheckClassID CHECK (CLASS_ID LIKE 'CLS[0-9][0-9][0-9][0-9][0-9]'),
	FOREIGN KEY (PROF_ID) REFERENCES Prof ON UPDATE CASCADE ON DELETE CASCADE
)

CREATE TABLE Enroll(
	STUD_ID CHAR(5) NOT NULL,
	CLASS_ID CHAR(8) NOT NULL,
	GRADE INT NOT NULL,

	CONSTRAINT CheckGrade CHECK (GRADE BETWEEN 0 AND 100),
	FOREIGN KEY (STUD_ID) REFERENCES Student ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (CLASS_ID) REFERENCES Class ON UPDATE CASCADE ON DELETE CASCADE
)

CREATE TABLE Room(
	ROOM_ID CHAR(5) PRIMARY KEY,
	ROOM_LOC VARCHAR(30) NOT NULL,
	ROOM_CAP INT NOT NULL,
	CLASS_ID CHAR(8) NOT NULL,

	CONSTRAINT CheckRoomID CHECK (ROOM_ID LIKE 'RM[0-9][0-9][0-9]'),
	FOREIGN KEY (CLASS_ID) REFERENCES Class ON UPDATE CASCADE ON DELETE CASCADE 
)
	
INSERT INTO Student VALUES
	('ST001','Roselin','Dwi','Bintang Street','Jakarta'),
	('ST002','Hanson','Budhi','Bulan Street','Jakarta'),
	('ST003','Daniel','Tjan','Pelangi Street','tangerang'),
	('ST004','Albert','Christian','Sky Street','Tangerang'),
	('ST005','Selin','Lynn','Sunshine Street','Jakarta')

INSERT INTO Prof VALUES
	('A00001','Michael','Kevin'),
	('A00002','Kevin','Albert'),
	('B00001','Lynn','Dwi'),
	('B00002','Septiani','Dwi'),
	('C00001','Roselin','Septiani')

INSERT INTO Class VALUES
	('CLS00001','Sunshine','A00002'),
	('CLS00002','Sky','A00001'),
	('CLS00003','Rainbow','B00002'),
	('CLS00004','Clouds','B00001'),
	('CLS00005','Stars','C00001')

INSERT INTO Enroll VALUES
	('ST001','CLS00002',90),
	('ST002','CLS00001',95),
	('ST003','CLS00003',85),
	('ST004','CLS00005',80),
	('ST005','CLS00004',90)

INSERT INTO Room VALUES
	('RM001','Floor 1A',70,'CLS00002'),
	('RM002','Floor 2A',40,'CLS00001'),
	('RM003','Floor 3A',30,'CLS00003'),
	('RM004','Floor 4A',80,'CLS00005'),
	('RM005','Floor 5A',20,'CLS00004')


--1
SELECT * FROM Student
WHERE STUD_CITY NOT LIKE 'Jakarta'
ORDER BY STUD_LNAME DESC

--2
SELECT PROF_ID, NAMA = PROF_FNAME + ' ' + PROF_LNAME
FROM Prof
WHERE PROF_FNAME LIKE 'A%'

--3
SELECT Prof.PROF_ID, Prof.PROF_FNAME, Prof.PROF_LNAME, Class.CLASS_ID, Class.CLASS_NAME
FROM Prof, Class
WHERE Prof.PROF_ID = Class.PROF_ID

--4
SELECT 
	CLASS_ID, 
	COUNT(GRADE) AS [Number of Student]
FROM Enroll
WHERE GRADE < 84 AND GRADE > 65
GROUP BY CLASS_ID

--5
SELECT 
	STUD_ID AS [Student ID],
	COUNT(CLASS_ID) AS [NUMBER CLASS > 3]
FROM Enroll
WHERE GRADE < 65 
GROUP BY STUD_ID
HAVING COUNT(CLASS_ID) > 3
ORDER BY [Student ID] ASC


DROP DATABASE University2



